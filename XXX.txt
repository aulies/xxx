from telethon.tl.types import InputMessagesFilterVideo
import random
from .. import loader, utils

@loader.tds
class XXX(loader.Module):
    """–ò–∑–≤—Ä–∞—â–µ–Ω–µ—Ü"""

    strings = {
        "name": "XXX",
        "choosing_video": "<emoji document_id=5328311576736833844>üî¥</emoji> –ü–æ–¥–±–∏—Ä–∞–µ–º –≤–∏–¥–µ–æ...",
        "no_videos_found": "<b>–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –≤–∏–¥–µ–æ –≤ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –∫–∞–Ω–∞–ª–µ.</b>",
        "no_channel": "<b>–ù–µ—Ç –∫–∞–Ω–∞–ª–∞ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.</b>",
    }

    version = (1, 0, 0)

    def __init__(self):
        self.config = loader.ModuleConfig(
            loader.ConfigValue(
                "custom_channel",
                "https://t.me/+OHfWOqhOsdcyMGE6",
                doc=lambda: "–í–≤–µ–¥–∏—Ç–µ —Å—é–¥–∞ —é–∑–µ—Ä–Ω–µ–π–º –∫–∞–Ω–∞–ª–∞ –∏–ª–∏ —Å—Å—ã–ª–∫—É –Ω–∞ –∫–∞–Ω–∞–ª. –í—ã –º–æ–∂–µ—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —ç—Ç—É —Å—Å—ã–ª–∫—É —á–µ—Ä–µ–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (cfg).",
            )
        )

    @loader.command()
    async def x(self, message):
        """–ö–∏–¥–∞–µ—Ç –≤ —á–∞—Ç –ø–æ—à–ª–æ—Å—Ç–∏ üòá"""
        channel = self.config["custom_channel"]

        if not channel:
            await utils.answer(message, self.strings["no_channel"])
            return

        choosing_msg = await utils.answer(message, self.strings["choosing_video"])

        try:
            videos = [
                msg async for msg in self.client.iter_messages(
                    channel,
                    limit=3000,
                    filter=InputMessagesFilterVideo,
                )
            ]

            if not videos:
                await utils.answer(message, self.strings["no_videos_found"])
                return

            video = random.choice(videos)

            await self.client.send_file(
                message.chat_id,
                video,
                caption=None,
                silent=True
            )

            await choosing_msg.delete()

        except Exception as e:
            await utils.answer(message, f"–û—à–∏–±–∫–∞: {e}")